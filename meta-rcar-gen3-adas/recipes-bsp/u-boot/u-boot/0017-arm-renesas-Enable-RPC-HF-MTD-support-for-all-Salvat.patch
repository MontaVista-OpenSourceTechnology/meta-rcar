From 058497e4a65623045e603ae8678764e6f49b62f6 Mon Sep 17 00:00:00 2001
From: Valentine Barshak <valentine.barshak@cogentembedded.com>
Date: Thu, 22 Nov 2018 00:17:56 +0300
Subject: [PATCH 17/21] arm: renesas: Enable RPC HF MTD support for all
 Salvator-X boards

This enables RPC HyperFlash MTD support
for all R-Car Gen3 Salvator-X boards.

Signed-off-by: Valentine Barshak <valentine.barshak@cogentembedded.com>
---
 arch/arm/dts/r8a7795-salvator-x-u-boot.dts       | 4 ++++
 arch/arm/dts/r8a7795-salvator-xs-2x2g-u-boot.dts | 4 ++++
 arch/arm/dts/r8a7795-salvator-xs-4x2g-u-boot.dts | 4 ++++
 arch/arm/dts/r8a7795-salvator-xs-u-boot.dts      | 4 ++++
 arch/arm/dts/r8a7796-salvator-x-u-boot.dts       | 4 ++++
 arch/arm/dts/r8a7796-salvator-xs-2x4g-u-boot.dts | 4 ++++
 arch/arm/dts/r8a7796-salvator-xs-u-boot.dts      | 4 ++++
 arch/arm/dts/r8a77965-salvator-x-u-boot.dts      | 4 ++++
 arch/arm/dts/r8a77965-salvator-xs-u-boot.dts     | 4 ++++
 configs/r8a7795_salvator-x_defconfig             | 7 +++++++
 configs/r8a7795_salvator-xs-2x2g_defconfig       | 7 +++++++
 configs/r8a7795_salvator-xs-4x2g_defconfig       | 7 +++++++
 configs/r8a7795_salvator-xs_defconfig            | 7 +++++++
 configs/r8a77965_salvator-x_defconfig            | 7 +++++++
 configs/r8a77965_salvator-xs_defconfig           | 7 +++++++
 configs/r8a7796_salvator-x_defconfig             | 7 +++++++
 configs/r8a7796_salvator-xs-2x4g_defconfig       | 7 +++++++
 configs/r8a7796_salvator-xs_defconfig            | 7 +++++++
 include/configs/salvator-x.h                     | 9 +++++++++
 19 files changed, 108 insertions(+)

diff --git a/arch/arm/dts/r8a7795-salvator-x-u-boot.dts b/arch/arm/dts/r8a7795-salvator-x-u-boot.dts
index e93afe3..b9a4d71 100644
--- a/arch/arm/dts/r8a7795-salvator-x-u-boot.dts
+++ b/arch/arm/dts/r8a7795-salvator-x-u-boot.dts
@@ -34,3 +34,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7795-salvator-xs-2x2g-u-boot.dts b/arch/arm/dts/r8a7795-salvator-xs-2x2g-u-boot.dts
index ee03ab3..aab08b3 100644
--- a/arch/arm/dts/r8a7795-salvator-xs-2x2g-u-boot.dts
+++ b/arch/arm/dts/r8a7795-salvator-xs-2x2g-u-boot.dts
@@ -35,3 +35,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7795-salvator-xs-4x2g-u-boot.dts b/arch/arm/dts/r8a7795-salvator-xs-4x2g-u-boot.dts
index a8bf246..256c3b8 100644
--- a/arch/arm/dts/r8a7795-salvator-xs-4x2g-u-boot.dts
+++ b/arch/arm/dts/r8a7795-salvator-xs-4x2g-u-boot.dts
@@ -35,3 +35,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7795-salvator-xs-u-boot.dts b/arch/arm/dts/r8a7795-salvator-xs-u-boot.dts
index 62ce9fa..cbe9e13 100644
--- a/arch/arm/dts/r8a7795-salvator-xs-u-boot.dts
+++ b/arch/arm/dts/r8a7795-salvator-xs-u-boot.dts
@@ -34,3 +34,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7796-salvator-x-u-boot.dts b/arch/arm/dts/r8a7796-salvator-x-u-boot.dts
index 2a7b149..473fd98 100644
--- a/arch/arm/dts/r8a7796-salvator-x-u-boot.dts
+++ b/arch/arm/dts/r8a7796-salvator-x-u-boot.dts
@@ -34,3 +34,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7796-salvator-xs-2x4g-u-boot.dts b/arch/arm/dts/r8a7796-salvator-xs-2x4g-u-boot.dts
index 91965f5..658a351 100644
--- a/arch/arm/dts/r8a7796-salvator-xs-2x4g-u-boot.dts
+++ b/arch/arm/dts/r8a7796-salvator-xs-2x4g-u-boot.dts
@@ -34,3 +34,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a7796-salvator-xs-u-boot.dts b/arch/arm/dts/r8a7796-salvator-xs-u-boot.dts
index ac4988d..61a3229 100644
--- a/arch/arm/dts/r8a7796-salvator-xs-u-boot.dts
+++ b/arch/arm/dts/r8a7796-salvator-xs-u-boot.dts
@@ -34,3 +34,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a77965-salvator-x-u-boot.dts b/arch/arm/dts/r8a77965-salvator-x-u-boot.dts
index e4bd2d3..39d4ed7 100644
--- a/arch/arm/dts/r8a77965-salvator-x-u-boot.dts
+++ b/arch/arm/dts/r8a77965-salvator-x-u-boot.dts
@@ -37,3 +37,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/arch/arm/dts/r8a77965-salvator-xs-u-boot.dts b/arch/arm/dts/r8a77965-salvator-xs-u-boot.dts
index 4634c6e..d6cd3e4 100644
--- a/arch/arm/dts/r8a77965-salvator-xs-u-boot.dts
+++ b/arch/arm/dts/r8a77965-salvator-xs-u-boot.dts
@@ -37,3 +37,7 @@
 &vcc_sdhi3 {
 	u-boot,off-on-delay-us = <20000>;
 };
+
+&rpc {
+	status = "okay";
+};
diff --git a/configs/r8a7795_salvator-x_defconfig b/configs/r8a7795_salvator-x_defconfig
index 2ced2cf..c25372e 100644
--- a/configs/r8a7795_salvator-x_defconfig
+++ b/configs/r8a7795_salvator-x_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7795_salvator-xs-2x2g_defconfig b/configs/r8a7795_salvator-xs-2x2g_defconfig
index 315d446..ca7b947 100644
--- a/configs/r8a7795_salvator-xs-2x2g_defconfig
+++ b/configs/r8a7795_salvator-xs-2x2g_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7795_salvator-xs-4x2g_defconfig b/configs/r8a7795_salvator-xs-4x2g_defconfig
index 82177ac..0923ce6 100644
--- a/configs/r8a7795_salvator-xs-4x2g_defconfig
+++ b/configs/r8a7795_salvator-xs-4x2g_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7795_salvator-xs_defconfig b/configs/r8a7795_salvator-xs_defconfig
index b05deab..1dfc51f 100644
--- a/configs/r8a7795_salvator-xs_defconfig
+++ b/configs/r8a7795_salvator-xs_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a77965_salvator-x_defconfig b/configs/r8a77965_salvator-x_defconfig
index 24804e2..167265f 100644
--- a/configs/r8a77965_salvator-x_defconfig
+++ b/configs/r8a77965_salvator-x_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a77965_salvator-xs_defconfig b/configs/r8a77965_salvator-xs_defconfig
index d94003a..8dec8ea 100644
--- a/configs/r8a77965_salvator-xs_defconfig
+++ b/configs/r8a77965_salvator-xs_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7796_salvator-x_defconfig b/configs/r8a7796_salvator-x_defconfig
index 0a2299f..226bac7 100644
--- a/configs/r8a7796_salvator-x_defconfig
+++ b/configs/r8a7796_salvator-x_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7796_salvator-xs-2x4g_defconfig b/configs/r8a7796_salvator-xs-2x4g_defconfig
index 2d5e7a0..36d23e0 100644
--- a/configs/r8a7796_salvator-xs-2x4g_defconfig
+++ b/configs/r8a7796_salvator-xs-2x4g_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/configs/r8a7796_salvator-xs_defconfig b/configs/r8a7796_salvator-xs_defconfig
index d38dab4..90e8aeb 100644
--- a/configs/r8a7796_salvator-xs_defconfig
+++ b/configs/r8a7796_salvator-xs_defconfig
@@ -50,6 +50,13 @@ CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS200_SUPPORT=y
 CONFIG_RENESAS_SDHI=y
+CONFIG_MTD=y
+CONFIG_DM_MTD=y
+CONFIG_MTD_NOR_FLASH=y
+CONFIG_FLASH_CFI_DRIVER=y
+CONFIG_CFI_FLASH=y
+CONFIG_FLASH_CFI_MTD=y
+CONFIG_RENESAS_RPC_HF=y
 CONFIG_PHY_MICREL=y
 CONFIG_PHY_MICREL_KSZ90X1=y
 CONFIG_DM_ETH=y
diff --git a/include/configs/salvator-x.h b/include/configs/salvator-x.h
index 669602e..2e00308 100644
--- a/include/configs/salvator-x.h
+++ b/include/configs/salvator-x.h
@@ -22,4 +22,13 @@
 #define CONFIG_SYS_MMC_ENV_DEV		1
 #define CONFIG_SYS_MMC_ENV_PART		2
 
+#define CONFIG_CFI_FLASH_USE_WEAK_ACCESSORS
+#define CONFIG_FLASH_SHOW_PROGRESS	45
+#define CONFIG_SYS_FLASH_BANKS_LIST	{ 0x08000000 }
+#define CONFIG_SYS_FLASH_CFI
+#define CONFIG_SYS_FLASH_CFI_WIDTH	FLASH_CFI_16BIT
+#define CONFIG_SYS_MAX_FLASH_BANKS_DETECT	1
+#define CONFIG_SYS_MAX_FLASH_SECT	256
+#define CONFIG_SYS_WRITE_SWAPPED_DATA
+
 #endif /* __SALVATOR_X_H */
-- 
2.7.4

